---
layout: topic
module: 性能优化
title:  缓存优化
date:   2017-01-26
---

#### 1. 缓存穿透

查询的数据在缓存和数据库中都不存在，导致每次请求都会查询数据库，缓存也就失去了意义

***解决方案***

1. 以特殊字符串或空对象代表不存在的数据放到缓存中，失效时间不能太长

#### 2. 缓存并发

高并发情况下，某个缓存失效，会导致多个进程同时查询数据库，对数据库造成压力

***解决方案***

1. 设置永久缓存，数据修改时更新，只适用于某些特殊场景
2. 创建定时任务，从数据库查询数据来更新缓存
3. 引入分布式锁，获得锁的进程查询数据库，其它进程等待解锁后查询缓存
4. 过期时间写入value，get时判断是否即将过期，是则开启任务从数据库查询数据来更新缓存(保证一个key只有一个任务)

#### 3. 缓存失效

某一段时间内，大量缓存集体失效，导致查询数据库，对数据库造成压力

***解决方案***

1. 使缓存实效时间分布均匀，可以在固定的失效时间上加上一个随机时间

#### 4. 缓存血崩

缓存宕机、大量缓存失效、大量数据未加载到缓存，导致大量请求查询数据库，使数据库负载过高甚至宕机

***解决方案***

1. 缓存宕机，可以考虑做主备，比如Redis主备  
2. 使缓存实效时间分布均匀，避免大量缓存同时失效  
3. 数据库查询限流(队列)  
4. 针对大量数据未加载到缓存，可以使用缓存预热
