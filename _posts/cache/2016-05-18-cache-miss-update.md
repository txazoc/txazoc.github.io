---
layout:     article
categories: [cache]
title:      缓存失效更新机制
tags:       [缓存, memcached, 失效]
date:       2016-05-18
---

缓存失效，从数据库查询，然后重新填充缓存。

缺点：高并发情况下，会造成多次数据库查询，分布式环境下，数据库查询次数更多，给数据库带来压力。

既然，高并发情况下，有多次数据库查询，可以控制单机下，对同一个key，只有一个线程去查询数据库填充缓存，其它线程等待缓存填充完成。

下面是基于Memcached的实现。

单机控制只有一个线程去查询数据库，但分布式环境下，每台机器都会去查询数据库，机器越多，对数据库带来的压力越大。

针对分布式环境，可以控制只有一台机器去查询数据库并填充缓存，其它机器则等待缓存填充完成。

上面的设计，缓存失效后才进行填充，查询缓存的请求会被wait。

一种更好的思路是进行缓存预填充，在缓存快要失效前，开启额外的线程去查询数据库并填充缓存。
