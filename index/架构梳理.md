---
layout: index
title:  架构梳理
---

* 存储: MySQL、Redis、ElasticSearch
* 通信: RPC、Kafka
* 基础架构: Eureka(注册中心)、Zuul(服务网关)、Apollo(配置中心)、Cat(监控中心)、XXL-JOB(调度中心)、ELK(日志中心)
* 框架: Spring、MyBatis
* 数据结构
* 多线程并发
* JVM

#### MyBatis

* 初始化: 数据库连接池、注册Mapper
* Mapper(动态代理) -&gt; SqlSession -&gt; Executor -&gt; 缓存(`二级 -> 一级`) -&gt; `prepare statement` -&gt; `set parameter` -&gt; `jdbc execute` -&gt; `handle resultSet`

#### Spring

* IOC: refresh、BeanFactory、BeanDefinition、实例化
    * 循环依赖
    * @Autowired、@Resource
* AOP: JDK动态代理、CGLib动态代理

#### Spring MVC

* DispatcherServlet -&gt; `mapping` -&gt; `preHandle` -&gt; `invoke` -&gt; `postHandle` -&gt; `view` -&gt; `afterCompletion`

#### Eureka(注册中心)

* 服务注册中心: 服务注册与发现
* AP

<img src="/images/spring/eureka.png" style="width: 480px; border-width: 1px;" title="Eureka" />

#### Feign

* 声明式的HTTP客户端，简化HTTP调用
* 动态代理
* httpclient/okhttp
* 整合Ribbon和Hystrix

#### Ribbon

* 客户端负载均衡

#### Hystrix

* 熔断器
* 资源隔离(线程池隔离)、熔断、降级
* Request -&gt; 熔断开关(fallback) -&gt; 线程池(fallback) -&gt; Remote Call(fallback)

<img src="/images/spring/hystrix.png" style="width: 480px; border-width: 1px;" title="Hystrix" />

<img src="/images/spring/hystrix-thread.png" style="width: 480px; border-width: 1px;" title="Hystrix Thread" />

#### Zuul(服务网关)

* 服务网关: 动态路由、监控、安全
* ZuulServlet -&gt; `pre filters` -&gt; `route filters` -&gt; `post filters`

<img src="/images/zuul/zuul-filter.png" style="width: 480px; border-width: 1px;" title="Zuul Filter" />

#### MySQL

* 主从、分库分表
* ACID、事务隔离级别、锁、MVCC
* InnoDB、索引、日志(重做日志、撤销日志)
* explain、SQL优化

#### Redis

* Redis Cluster: 分片(16384个槽)
* 数据结构: string、list、set、zset、hash
* 内存淘汰机制
* 持久化: AOF、RDB
* 单线程: IO多路复用
* 分布式锁: setnx

#### ElasticSearch

* 集群: 去中心化、分片、副本
* 集群 -&gt; 节点 -&gt; 索引 -&gt; 类型 -&gt; 文档 -&gt; 字段
* Lucene: `Term Index` -&gt; `Term Dictionary` -&gt; `Posting List`

#### Kafka

* 集群: Zookeeper、分区、副本
* Producer: 顺序消息、`request.required.acks`(0、1、-1)
* Broker: 顺序IO、Zero Copy、topic、offset
* Consumer: 消费组、pull、消息投递语义(At most once、At least once、Exactly once(幂等性))
* 解耦、削峰、异步化

#### Apollo(配置中心)

* Eureka、MetaServer、ConfigService、AdminService
* 环境 -&gt; 集群 -&gt; Namespace -&gt; 配置项
* Client: 长连接、push & pull、内存缓存、本地文件缓存
* @Value: 集成Spring

<img src="/images/apollo/apollo.jpg" style="width: 480px; border-width: 1px;" title="Apollo" />

#### Cat(监控中心)

* 客户端: 消息树 -&gt; 消息队列 -&gt; 异步上报 -&gt; Netty -&gt; Cat服务端
* 服务端: Netty -&gt; `Receiver Thread` -&gt; 消息队列 -&gt; `domain hash` -&gt; `Analyzer Thread`
* 存储
    * 消息
    * 报表: 消息 -&gt; 本地文件 -&gt; HDFS
* 分布式链路追踪: rootMessageId、parentMessageId、messageId

#### XXL-JOB(调度中心)

* 调度中心: Quartz分布式调度 -&gt; 调度线程池 -&gt; `选择执行器` -&gt; `发送调度请求`
* 执行器: `心跳注册`、`接收调度请求` -&gt; `新建线程执行job` -&gt; `上报日志和调度结果`

<img src="/images/xxljob.png" style="width: 480px; border-width: 1px;" title="XXL-JOB" />

#### ELK(日志中心)

* 日志 -&gt; Log4j2 -&gt; 本地文件 -&gt; LogStash -&gt; ElasticSearch -&gt; Kibaba

<img src="/images/elk.png" style="width: 480px; border-width: 1px;" title="ELK" />

#### 数据结构

* 二叉堆

#### JVM

#### 移动运营配置平台

![Appkit](https://tech.meituan.com/2018/09/27/appkit.html)

#### 订单卡券聚合中心

#### Mock平台

#### 内容分发平台

#### DDD框架

* Command -&gt; DDD -&gt; Domain -&gt; Repository -&gt; Dao
* DDD: 队列 -&gt; 线程池 -&gt; `Command Mapping` -&gt; `Filter Chain` -&gt; invoke
* 可配置: 线程池大小、限流

#### 类MyBatis组件

* SQL语句xml配置化

#### SOA异步化组件

* ThreadLocal、CountDownLatch
* ListenableFuture、注册回调

#### Cat集成

* 集成ES、Redis、Spring Cloud

#### XXL-JOB二次开发

* 新增用户和权限管理
* 日志存储由本地文件迁移至ES: ThreadLocal、Guava Cache、AtomicInteger
